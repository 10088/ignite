<?xml version="1.0" encoding="UTF-8"?>

<!--
    _________        _____ __________________        _____
    __  ____/___________(_)______  /__  ____/______ ____(_)_______
    _  / __  __  ___/__  / _  __  / _  / __  _  __ `/__  / __  __ \
    / /_/ /  _  /    _  /  / /_/ /  / /_/ /  / /_/ / _  /  _  / / /
    \____/   /_/     /_/   \_,__/   \____/   \__,_/  /_/   /_/ /_/

    @xml.file.header
    Version: @xml.file.version
-->

<!--
    GridGain Spring configuration file to startup grid cache for Hibernate example.

    When starting a standalone GridGain node, you need to execute the following command:
    {GRIDGAIN_HOME}/bin/ggstart.{bat|sh} examples/config/example-cache-hibernate.xml

    When starting GridGain from Java IDE, pass path to this file into GridFactory:
    GridFactory.start("examples/config/example-cache-hibernate.xml");
-->
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">
    <!-- Optional description. -->
    <description>
        Spring file for GridGain Hibernate Second-Level Cache example.
    </description>

    <!-- Basic configuration for atomic cache. -->
    <bean id="atomic-cache" class="org.gridgain.grid.cache.GridCacheConfiguration" abstract="true">
        <property name="cacheMode" value="PARTITIONED"/>
        <property name="atomicityMode" value="ATOMIC"/>
        <property name="writeSynchronizationMode" value="FULL_SYNC"/>
    </bean>

    <!-- Basic configuration for transactional cache. -->
    <bean id="transactional-cache" class="org.gridgain.grid.cache.GridCacheConfiguration" abstract="true">
        <property name="cacheMode" value="PARTITIONED"/>
        <property name="atomicityMode" value="TRANSACTIONAL"/>
        <property name="writeSynchronizationMode" value="FULL_SYNC"/>
    </bean>

    <!-- Configuration for GridGain node. -->
    <bean id="grid.cfg" class="org.gridgain.grid.GridConfiguration">
        <!--
            Define the grid name, used in GridHibernateL2CacheExample for specifying
            the Hibernate L2 cache node.
        -->
        <property name="gridName" value="hibernate-grid"/>

        <!--
            Use loopback IP, which limits node discovery to local host only.
            You may also remove this setting, if you'd like to
            connect the nodes from different machines (an external IP address
            will be used in this case).
        -->
        <property name="localHost" value="127.0.0.1"/>

        <!-- We don't need REST service for this example. -->
        <property name="restEnabled" value="false"/>

        <!--
            Configure the caches for Hibernate L2. Notice that the timestamps cache
            and query cache may be atomic, because no complex transactions are
            involved in this case. However, for entity caches (User, User.posts, Post)
            we define transactional cache.
        -->
        <property name="cacheConfiguration">
            <list>
                <bean parent="atomic-cache">
                    <property name="name" value="org.hibernate.cache.spi.UpdateTimestampsCache"/>
                </bean>
                <bean parent="atomic-cache">
                    <property name="name" value="org.hibernate.cache.internal.StandardQueryCache"/>
                </bean>
                <bean parent="transactional-cache">
                    <property name="name" value="org.gridgain.examples.advanced.datagrid.hibernate.User"/>
                </bean>
                <bean parent="transactional-cache">
                    <property name="name" value="org.gridgain.examples.advanced.datagrid.hibernate.User.posts"/>
                </bean>
                <bean parent="transactional-cache">
                    <property name="name" value="org.gridgain.examples.advanced.datagrid.hibernate.Post"/>
                </bean>
            </list>
        </property>

        <!--
            Specify the discovery SPI to configure how nodes join into a topology.
            The current setting only lets the nodes from local host join together.
            If you'd like to build a topology of nodes from different machines,
            please, remove the localHost setting and specify the full list of
            IP addresses of your machines in the list below (you may specify
            the same 47500 port for each IP - additional nodes, from the same
            machine will increment the port number automatically).
        -->
        <property name="discoverySpi">
            <bean class="org.gridgain.grid.spi.discovery.tcp.GridTcpDiscoverySpi">
                <property name="ipFinder">
                    <bean class="org.gridgain.grid.spi.discovery.tcp.ipfinder.vm.GridTcpDiscoveryVmIpFinder">
                        <property name="addresses">
                            <list>
                                <value>127.0.0.1:47500</value>
                            </list>
                        </property>
                    </bean>
                </property>
            </bean>
        </property>
    </bean>
</beans>
