Apache Ignite Schema-loading Module
------------------------------

Apache Ignite Schema-loading module provides a simple utility that automatically reads the database schema,
creates required type mapping description, and optionally generates the domain model in Java.

For running utility use 'ignite-schema-load.{sh|bat}' script. For connection with RDBMS system from utility
you need to provide: connection url and jdbc driver.


Moving from disk-based architectures to in-memory architectures
------------------------------------------

Use Schema-loading utility for generation of type mapping and domain model in Java.

For example you may use the following script for create sample type in your RDBMS system:

CREATE TABLE Person(id integer not null, firstName varchar(50), lastName varchar(50), PRIMARY KEY(id));

You need place domain model classes, jdbc driver (used for connect to you RDBMS system) in Ignite node classpath,
for example place in 'libs' folder.

Append type mapping description generated by Schema-loading utility to your cache configuration and setup DataSource
to your RDBMS system for cache store.

Example of spring configuration:

<bean class="org.apache.ignite.configuration.IgniteConfiguration">
    ...
    <!-- Cache configuration. -->
    <property name="cacheConfiguration">
        <list>
            <bean class="org.apache.ignite.configuration.CacheConfiguration">
                ...

                <!-- Cache store. -->
                <property name="cacheStoreFactory">
                    <bean class="javax.cache.configuration.FactoryBuilder$SingletonFactory">
                        <constructor-arg>
                            <bean class="org.apache.ignite.cache.store.jdbc.CacheJdbcPojoStore">
                                <property name="dataSource">
                                    <!-- TODO: Need specify connection pooling DataSource to your RDBMS system. -->
                                    ...
                                </property>
                            </bean>
                        </constructor-arg>
                    </bean>
                </property>

                <!-- Type mapping description. -->
                <property name="typeMetadata">
                    <list>
                        <bean class="org.apache.ignite.cache.CacheTypeMetadata">
                            <property name="databaseTable" value="PERSON"/>
                            <property name="keyType" value="org.apache.ignite.examples.datagrid.store.model.PersonKey"/>
                            <property name="valueType" value="org.apache.ignite.examples.datagrid.store.model.Person"/>
                            <property name="keyFields">
                                <list>
                                    <bean class="org.apache.ignite.cache.CacheTypeFieldMetadata">
                                        <property name="databaseName" value="ID"/>
                                        <property name="databaseType">
                                            <util:constant static-field="java.sql.Types.BIGINT"/>
                                        </property>
                                        <property name="javaName" value="id"/>
                                        <property name="javaType" value="long"/>
                                    </bean>
                                </list>
                            </property>
                            <property name="valueFields">
                                <list>
                                    <bean class="org.apache.ignite.cache.CacheTypeFieldMetadata">
                                        <property name="databaseName" value="ID"/>
                                        <property name="databaseType">
                                            <util:constant static-field="java.sql.Types.BIGINT"/>
                                        </property>
                                        <property name="javaName" value="id"/>
                                        <property name="javaType" value="long"/>
                                    </bean>
                                    <bean class="org.apache.ignite.cache.CacheTypeFieldMetadata">
                                        <property name="databaseName" value="FIRST_NAME"/>
                                        <property name="databaseType">
                                            <util:constant static-field="java.sql.Types.VARCHAR"/>
                                        </property>
                                        <property name="javaName" value="firstName"/>
                                        <property name="javaType" value="java.lang.String"/>
                                    </bean>
                                    <bean class="org.apache.ignite.cache.CacheTypeFieldMetadata">
                                        <property name="databaseName" value="LAST_NAME"/>
                                        <property name="databaseType">
                                            <util:constant static-field="java.sql.Types.VARCHAR"/>
                                        </property>
                                        <property name="javaName" value="lastName"/>
                                        <property name="javaType" value="java.lang.String"/>
                                    </bean>
                                </list>
                            </property>
                        </bean>
                    </list>
                </property>
                ...
            </bean>
        </list>
    </property>
    ...
</bean>

Example of java code configuration:

IgniteConfiguration cfg = new IgniteConfiguration();
...
CacheConfiguration ccfg = new CacheConfiguration<>();

DataSource dataSource = null; // TODO: Need specify connection pooling DataSource to your RDBMS system.

// Create store.
CacheJdbcPojoStore store = new CacheJdbcPojoStore();
store.setDataSource(dataSource);

// Create store factory.
ccfg.setCacheStoreFactory(new FactoryBuilder.SingletonFactory<>(store));

// Configure cache to use store.
ccfg.setReadThrough(true);
ccfg.setWriteThrough(true);

cfg.setCacheConfiguration(ccfg);

// Configure cache types.
Collection<CacheTypeMetadata> meta = new ArrayList<>();

// PERSON.
CacheTypeMetadata type = new CacheTypeMetadata();
type.setDatabaseSchema("PUBLIC");
type.setDatabaseTable("PERSON");
type.setKeyType(long.class.getName());
type.setValueType("org.apache.ignite.examples.datagrid.store.model.Person");

// Key fields for PERSON.
Collection<CacheTypeFieldMetadata> keys = new ArrayList<>();
keys.add(new CacheTypeFieldMetadata("ID", java.sql.Types.BIGINT,"id", long.class));
type.setKeyFields(keys);

// Value fields for PERSON.
Collection<CacheTypeFieldMetadata> vals = new ArrayList<>();
vals.add(new CacheTypeFieldMetadata("ID", java.sql.Types.BIGINT,"id", long.class));
vals.add(new CacheTypeFieldMetadata("ORG_ID", java.sql.Types.INTEGER,"orgId", Integer.class));
vals.add(new CacheTypeFieldMetadata("NAME", java.sql.Types.VARCHAR,"name", String.class));
type.setValueFields(vals);
...
// Start Ignite node.
Ignition.start(cfg);
